name: 1ï¸âƒ£ RC Draft Release

on:
  workflow_run:
    workflows: ["CI Quality Gate"]
    types: [completed]
    branches: [develop]

permissions:
  contents: write

jobs:
  create-draft-release:
    name: Create Draft Release
    runs-on: ubuntu-latest
    if: ${{ github.event.workflow_run.conclusion == 'success' }}

    steps:
      - name: ðŸ“¥ Checkout code
        uses: actions/checkout@v4
        with:
          ref: ${{ github.event.workflow_run.head_branch }}
          fetch-depth: 0

      - name: ðŸ·ï¸ Generate RC Version
        id: version
        run: |
          SHORT_SHA=$(echo "${{ github.event.workflow_run.head_sha }}" | cut -c1-7)
          TIMESTAMP=$(date +%Y%m%d_%H%M%S)
          RC_VERSION="v0.0.0-rc.${TIMESTAMP}.${SHORT_SHA}"
          echo "rc_version=${RC_VERSION}" >> $GITHUB_OUTPUT
          echo "RC Version: ${RC_VERSION}"

      - name: ðŸ“¤ Create Draft Release
        uses: softprops/action-gh-release@v2
        with:
          tag_name: ${{ steps.version.outputs.rc_version }}
          draft: true
          body: |
            # Release Candidate
            **Version:** ${{ steps.version.outputs.rc_version }}
            **Status:** Waiting for team approval
            **Branch:** develop
            **Commit:** ${{ github.event.workflow_run.head_sha }}

            ## What's Included
            - âœ… All tests passed
            - âœ… Code quality checks completed (ESLint)
            - âœ… Unit tests completed with coverage
            - âœ… Build artifacts created

            ## To Approve
            Review the test reports in the [CI Quality Gate workflow](${{ github.event.workflow_run.html_url }}), then:
            1. Edit this release
            2. Click **Publish release**

            This will trigger the merge to `main` and deployment to staging.
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
